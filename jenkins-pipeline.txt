pipeline {
      environment {

          rootProjectDirectory = "./";

          buildDirectory = "${rootProjectDirectory}/Build-Server";

          terraformDirectory = "${rootProjectDirectory}/terraform";

          dockerImage = "http-py-server" // docker image name

    }
    agent any

    stages {
        stage('Build') {

            steps{

                // Set the directory for terraform to use for running
                dir("${terraformDirectory}") {
                echo 'Preparing the Infrastructure ....'
                sh "terraform init"
                sh "terraform plan -out=plan1"
                }
            }

        }
        stage('Test') {
            steps {

            echo 'Testing....'

            }
        }
        stage('Deploy') {
            steps {

                echo 'Deploying....'

                // Set the directory for terraform
                dir("${terraformDirectory}") {
                echo 'Creating Terraform Infastructure ....'
                sh "terraform apply --auto-approve"
                }

                // Need to push docker image to kubernetes cluster


            }
        }
    }
}
